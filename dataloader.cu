#include "dataloader.cuh"
#include <fstream>
#include <sstream>
#include <algorithm>
#include <limits>

std::vector<std::vector<float>> loadCSV(const std::string& path) {
    std::vector<std::vector<float>> result;
    std::ifstream file(path);
    if (!file) return result;

    std::string line;
    while (std::getline(file, line)) {
        if (line.empty()) continue;
        std::vector<float> row;
        std::stringstream ss(line);
        std::string cell;
        bool valid = true;
        while (std::getline(ss, cell, ',')) {
            try {
                row.push_back(std::stof(cell));
            } catch (...) {
                valid = false;
                break;
            }
        }
        if (valid && !row.empty()) result.push_back(row);
    }
    return result;
}

void splitDataRegression(const std::vector<std::vector<float>>& data, int num_features,
                         std::vector<std::vector<float>>& X, std::vector<std::vector<float>>& y) {
    X.clear();
    y.clear();
    for (const auto& row : data) {
        if ((int)row.size() < num_features + 1) continue;
        std::vector<float> feat(row.begin(), row.begin() + num_features);
        std::vector<float> target(1, row[num_features]);
        X.push_back(feat);
        y.push_back(target);
    }
}

void splitDataClassification(const std::vector<std::vector<float>>& data, int num_features,
                             int num_classes, std::vector<std::vector<float>>& X,
                             std::vector<int>& labels) {
    (void)num_classes;
    X.clear();
    labels.clear();
    for (const auto& row : data) {
        if ((int)row.size() < num_features + 1) continue;
        std::vector<float> feat(row.begin(), row.begin() + num_features);
        int label = static_cast<int>(row[num_features]);
        X.push_back(feat);
        labels.push_back(label);
    }
}

void normalizeFeaturesMinMax(std::vector<std::vector<float>>& X) {
    if (X.empty()) return;
    int cols = static_cast<int>(X[0].size());
    for (int c = 0; c < cols; c++) {
        float mn = std::numeric_limits<float>::max();
        float mx = std::numeric_limits<float>::lowest();
        for (const auto& row : X) {
            if (c < (int)row.size()) {
                mn = std::min(mn, row[c]);
                mx = std::max(mx, row[c]);
            }
        }
        float range = mx - mn;
        if (range < 1e-9f) range = 1.0f;
        for (auto& row : X) {
            if (c < (int)row.size()) row[c] = (row[c] - mn) / range;
        }
    }
}

// UCI Iris: 150 samples, 4 features (sepal length, width, petal length, width), 3 classes
// setosa=0 (rows 0-49), versicolor=1 (50-99), virginica=2 (100-149)
static const float IRIS_X[150][4] = {
    {5.1f,3.5f,1.4f,0.2f},{4.9f,3.0f,1.4f,0.2f},{4.7f,3.2f,1.3f,0.2f},{4.6f,3.1f,1.5f,0.2f},{5.0f,3.6f,1.4f,0.2f},
    {5.4f,3.9f,1.7f,0.4f},{4.6f,3.4f,1.4f,0.3f},{5.0f,3.4f,1.5f,0.2f},{4.4f,2.9f,1.4f,0.2f},{4.9f,3.1f,1.5f,0.1f},
    {5.4f,3.7f,1.5f,0.2f},{4.8f,3.4f,1.6f,0.2f},{4.8f,3.0f,1.4f,0.1f},{4.3f,3.0f,1.1f,0.1f},{5.8f,4.0f,1.2f,0.2f},
    {5.7f,4.4f,1.5f,0.4f},{5.4f,3.9f,1.3f,0.4f},{5.1f,3.5f,1.4f,0.3f},{5.7f,3.8f,1.7f,0.3f},{5.1f,3.8f,1.5f,0.3f},
    {5.4f,3.4f,1.7f,0.2f},{5.1f,3.7f,1.5f,0.4f},{4.6f,3.6f,1.0f,0.2f},{5.1f,3.3f,1.7f,0.5f},{4.8f,3.4f,1.9f,0.2f},
    {5.0f,3.0f,1.6f,0.2f},{5.0f,3.4f,1.6f,0.4f},{5.2f,3.5f,1.5f,0.2f},{5.2f,3.4f,1.4f,0.2f},{4.7f,3.2f,1.6f,0.2f},
    {4.8f,3.1f,1.6f,0.2f},{5.4f,3.4f,1.5f,0.4f},{5.2f,4.1f,1.5f,0.1f},{5.5f,4.2f,1.4f,0.2f},{4.9f,3.1f,1.5f,0.1f},
    {5.0f,3.2f,1.2f,0.2f},{5.5f,3.5f,1.3f,0.2f},{4.9f,3.1f,1.5f,0.1f},{4.4f,3.0f,1.3f,0.2f},{5.1f,3.4f,1.5f,0.2f},
    {5.0f,3.5f,1.3f,0.3f},{4.5f,2.3f,1.3f,0.3f},{4.4f,3.2f,1.3f,0.2f},{5.0f,3.5f,1.6f,0.6f},{5.1f,3.8f,1.9f,0.4f},
    {4.8f,3.0f,1.4f,0.3f},{5.1f,3.8f,1.6f,0.2f},{4.6f,3.2f,1.4f,0.2f},{5.3f,3.7f,1.5f,0.2f},{5.0f,3.3f,1.4f,0.2f},
    {7.0f,3.2f,4.7f,1.4f},{6.4f,3.2f,4.5f,1.5f},{6.9f,3.1f,4.9f,1.5f},{5.5f,2.3f,4.0f,1.3f},{6.5f,2.8f,4.6f,1.5f},
    {5.7f,2.8f,4.5f,1.3f},{6.3f,3.3f,4.7f,1.6f},{4.9f,2.4f,3.3f,1.0f},{6.6f,2.9f,4.6f,1.3f},{5.2f,2.7f,3.9f,1.4f},
    {5.0f,2.0f,3.5f,1.0f},{5.9f,3.0f,4.2f,1.5f},{6.0f,2.2f,4.0f,1.0f},{6.1f,2.9f,4.7f,1.4f},{5.6f,2.9f,3.6f,1.3f},
    {6.7f,3.1f,4.4f,1.4f},{5.6f,3.0f,4.5f,1.5f},{5.8f,2.7f,4.1f,1.0f},{6.2f,2.2f,4.5f,1.5f},{5.6f,2.5f,3.9f,1.1f},
    {5.9f,3.2f,4.8f,1.8f},{6.1f,2.8f,4.0f,1.3f},{6.3f,2.5f,4.9f,1.5f},{6.1f,2.8f,4.7f,1.2f},{6.4f,2.9f,4.3f,1.3f},
    {6.6f,3.0f,4.4f,1.4f},{6.8f,2.8f,4.8f,1.4f},{6.7f,3.0f,5.0f,1.7f},{6.0f,2.9f,4.5f,1.5f},{5.7f,2.6f,3.5f,1.0f},
    {5.5f,2.4f,3.8f,1.1f},{5.5f,2.4f,3.7f,1.0f},{5.8f,2.7f,3.9f,1.2f},{6.0f,2.7f,5.1f,1.6f},{5.4f,3.0f,4.5f,1.5f},
    {6.0f,3.4f,4.5f,1.6f},{6.7f,3.1f,4.7f,1.5f},{6.3f,2.3f,4.4f,1.3f},{5.6f,3.0f,4.1f,1.3f},{5.5f,2.5f,4.0f,1.3f},
    {5.5f,2.6f,4.4f,1.2f},{6.1f,3.0f,4.6f,1.4f},{5.8f,2.6f,4.0f,1.2f},{5.0f,2.3f,3.3f,1.0f},{5.6f,2.7f,4.2f,1.3f},
    {5.7f,3.0f,4.2f,1.2f},{5.7f,2.9f,4.2f,1.3f},{6.2f,2.9f,4.3f,1.3f},{5.1f,2.5f,3.0f,1.1f},{5.7f,2.8f,4.1f,1.3f},
    {6.3f,3.3f,6.0f,2.5f},{5.8f,2.7f,5.1f,1.9f},{7.1f,3.0f,5.9f,2.1f},{6.3f,2.9f,5.6f,1.8f},{6.5f,3.0f,5.8f,2.2f},
    {7.6f,3.0f,6.6f,2.1f},{4.9f,2.5f,4.5f,1.7f},{7.3f,2.9f,6.3f,1.8f},{6.7f,2.5f,5.8f,1.8f},{7.2f,3.6f,6.1f,2.5f},
    {6.5f,3.2f,5.1f,2.0f},{6.4f,2.7f,5.3f,1.9f},{6.8f,3.0f,5.5f,2.1f},{5.7f,2.5f,5.0f,2.0f},{5.8f,2.8f,5.1f,2.4f},
    {6.4f,3.2f,5.3f,2.3f},{6.5f,3.0f,5.5f,1.8f},{7.7f,3.8f,6.7f,2.2f},{7.7f,2.6f,6.9f,2.3f},{6.0f,2.2f,5.0f,1.5f},
    {6.9f,3.2f,5.7f,2.3f},{5.6f,2.8f,4.9f,2.0f},{7.7f,2.8f,6.7f,2.0f},{6.3f,2.7f,4.9f,1.8f},{6.7f,3.3f,5.7f,2.1f},
    {7.2f,3.2f,6.0f,1.8f},{6.2f,2.8f,4.8f,1.8f},{6.1f,3.0f,4.9f,1.8f},{6.4f,2.8f,5.6f,2.1f},{7.2f,3.0f,5.8f,1.6f},
    {7.4f,2.8f,6.1f,1.9f},{7.9f,3.8f,6.4f,2.0f},{6.4f,2.8f,5.6f,2.2f},{6.3f,2.8f,5.1f,1.5f},{6.1f,2.6f,5.6f,1.4f},
    {7.7f,3.0f,6.1f,2.3f},{6.3f,3.4f,5.6f,2.4f},{6.4f,3.1f,5.5f,1.8f},{6.0f,3.0f,4.8f,1.8f},{6.9f,3.1f,5.4f,2.1f},
    {6.7f,3.1f,5.6f,2.4f},{6.9f,3.1f,5.1f,2.3f},{5.8f,2.7f,5.1f,1.9f},{6.8f,3.2f,5.9f,2.3f},{6.7f,3.3f,5.7f,2.5f},
    {6.7f,3.0f,5.2f,2.3f},{6.3f,2.5f,5.0f,1.9f},{6.5f,3.0f,5.2f,2.0f},{6.2f,3.4f,5.4f,2.3f},{5.9f,3.0f,5.1f,1.8f}
};

static const int IRIS_Y[150] = {
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
    2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2
};

std::pair<std::vector<std::vector<float>>, std::vector<int>> loadBuiltinIris() {
    std::vector<std::vector<float>> X;
    std::vector<int> labels;
    X.reserve(150);
    labels.reserve(150);
    for (int i = 0; i < 150; i++) {
        X.push_back({IRIS_X[i][0], IRIS_X[i][1], IRIS_X[i][2], IRIS_X[i][3]});
        labels.push_back(IRIS_Y[i]);
    }
    return {X, labels};
}

// UCI Wine: 178 samples, 13 features, class 1/2/3 -> 0/1/2 (sklearn format: features + class 0/1/2 at end)
static const float WINE_X[178][13] = {
    {14.23f,1.71f,2.43f,15.6f,127.f,2.8f,3.06f,0.28f,2.29f,5.64f,1.04f,3.92f,1065.f},{13.2f,1.78f,2.14f,11.2f,100.f,2.65f,2.76f,0.26f,1.28f,4.38f,1.05f,3.4f,1050.f},
    {13.16f,2.36f,2.67f,18.6f,101.f,2.8f,3.24f,0.3f,2.81f,5.68f,1.03f,3.17f,1185.f},{14.37f,1.95f,2.5f,16.8f,113.f,3.85f,3.49f,0.24f,2.18f,7.8f,0.86f,3.45f,1480.f},
    {13.24f,2.59f,2.87f,21.f,118.f,2.8f,2.69f,0.39f,1.82f,4.32f,1.04f,2.93f,735.f},{14.2f,1.76f,2.45f,15.2f,112.f,3.27f,3.39f,0.34f,1.97f,6.75f,1.05f,2.85f,1450.f},
    {14.39f,1.87f,2.45f,14.6f,96.f,2.5f,2.52f,0.3f,1.98f,5.25f,1.02f,3.58f,1290.f},{14.06f,2.15f,2.61f,17.6f,121.f,2.6f,2.51f,0.31f,1.25f,5.05f,1.06f,3.58f,1295.f},
    {14.83f,1.64f,2.17f,14.f,97.f,2.8f,2.98f,0.29f,1.98f,5.2f,1.08f,2.85f,1045.f},{13.86f,1.35f,2.27f,16.f,98.f,2.98f,3.15f,0.22f,1.85f,7.22f,1.01f,3.55f,1045.f},
    {14.1f,2.16f,2.3f,18.f,105.f,2.95f,3.32f,0.22f,2.38f,5.75f,1.25f,3.17f,1510.f},{14.12f,1.48f,2.32f,16.8f,95.f,2.2f,2.43f,0.26f,1.57f,5.f,1.17f,2.82f,1280.f},
    {13.75f,1.73f,2.41f,16.f,89.f,2.6f,2.76f,0.29f,1.81f,5.6f,1.15f,2.9f,1320.f},{14.75f,1.73f,2.39f,11.4f,91.f,3.1f,3.69f,0.43f,2.81f,5.4f,1.25f,2.73f,1150.f},
    {14.38f,1.87f,2.38f,12.f,102.f,3.3f,3.64f,0.29f,2.96f,7.5f,1.2f,3.f,1547.f},{13.63f,1.81f,2.7f,17.2f,112.f,2.85f,2.91f,0.3f,1.46f,7.3f,1.28f,2.88f,1310.f},
    {14.3f,1.92f,2.72f,20.f,120.f,2.8f,3.14f,0.33f,1.97f,6.2f,1.07f,2.65f,1280.f},{13.83f,1.57f,2.62f,20.f,115.f,2.95f,3.4f,0.4f,1.72f,6.6f,1.13f,2.57f,1130.f},
    {14.19f,1.59f,2.48f,16.5f,108.f,3.3f,3.93f,0.32f,1.86f,8.7f,1.23f,2.82f,1680.f},{13.64f,3.1f,2.56f,15.2f,116.f,2.7f,3.03f,0.17f,1.66f,5.1f,0.96f,3.36f,845.f},
    {14.06f,1.63f,2.28f,16.f,126.f,3.f,3.17f,0.24f,2.1f,5.65f,1.09f,3.71f,780.f},{12.93f,3.8f,2.65f,18.6f,102.f,2.41f,2.41f,0.25f,1.98f,4.5f,1.03f,3.52f,770.f},
    {13.71f,1.86f,2.36f,16.6f,101.f,2.61f,2.88f,0.27f,1.69f,3.8f,1.11f,4.f,1035.f},{12.85f,1.6f,2.52f,17.8f,95.f,2.48f,2.37f,0.26f,1.46f,3.93f,1.09f,3.63f,1015.f},
    {13.5f,1.81f,2.61f,20.f,96.f,2.53f,2.61f,0.28f,1.66f,3.52f,1.12f,3.82f,845.f},{13.05f,2.05f,3.22f,25.f,124.f,2.63f,2.68f,0.47f,1.92f,3.58f,1.13f,3.2f,830.f},
    {13.39f,1.77f,2.62f,16.1f,93.f,2.85f,2.94f,0.34f,1.45f,4.8f,0.92f,3.22f,1195.f},{13.3f,1.72f,2.14f,17.f,94.f,2.4f,2.19f,0.27f,1.35f,3.95f,1.02f,2.77f,1285.f},
    {13.87f,1.9f,2.8f,19.4f,107.f,2.95f,2.97f,0.37f,1.76f,4.5f,1.25f,3.4f,915.f},{14.02f,1.68f,2.21f,16.f,96.f,2.65f,2.33f,0.26f,1.98f,4.7f,1.04f,3.59f,1035.f},
    {13.73f,1.5f,2.7f,22.5f,101.f,3.f,3.25f,0.29f,2.38f,5.7f,1.19f,2.71f,1285.f},{13.58f,1.66f,2.36f,19.1f,106.f,2.86f,3.19f,0.22f,1.95f,6.9f,1.09f,2.88f,1515.f},
    {13.68f,1.83f,2.36f,17.2f,104.f,2.42f,2.69f,0.42f,1.97f,3.84f,1.23f,2.87f,990.f},{13.76f,1.53f,2.7f,19.5f,132.f,2.95f,2.74f,0.5f,1.35f,5.4f,1.25f,3.f,1235.f},
    {13.51f,1.8f,2.65f,19.f,110.f,2.35f,2.53f,0.29f,1.54f,4.2f,1.1f,2.87f,1095.f},{13.48f,1.81f,2.41f,20.5f,100.f,2.7f,2.98f,0.26f,1.86f,5.1f,1.04f,3.47f,920.f},
    {13.28f,1.64f,2.84f,15.5f,110.f,2.6f,2.68f,0.34f,1.36f,4.6f,1.09f,2.78f,880.f},{13.05f,1.65f,2.55f,18.f,98.f,2.45f,2.43f,0.29f,1.44f,4.25f,1.12f,2.51f,1105.f},
    {13.07f,1.5f,2.1f,15.5f,98.f,2.4f,2.64f,0.28f,1.37f,3.7f,1.18f,2.69f,1020.f},{14.22f,3.99f,2.51f,13.2f,128.f,3.f,3.04f,0.2f,2.08f,5.1f,0.89f,3.53f,760.f},
    {13.56f,1.71f,2.31f,16.2f,117.f,3.15f,3.29f,0.34f,2.34f,6.13f,0.95f,3.38f,795.f},{13.41f,3.84f,2.12f,18.8f,90.f,2.45f,2.68f,0.27f,1.48f,4.28f,0.91f,3.f,1035.f},
    {13.88f,1.89f,2.59f,15.f,101.f,3.25f,3.56f,0.17f,1.7f,5.43f,0.88f,3.56f,1095.f},{13.24f,3.98f,2.29f,17.5f,103.f,2.64f,2.63f,0.32f,1.66f,4.36f,0.82f,3.f,680.f},
    {13.05f,1.77f,2.1f,17.f,107.f,3.f,3.f,0.28f,2.03f,5.04f,0.88f,3.35f,885.f},{14.21f,4.04f,2.44f,18.9f,111.f,2.85f,2.65f,0.3f,1.25f,5.24f,0.87f,3.33f,1080.f},
    {14.38f,3.59f,2.28f,16.f,102.f,3.25f,3.17f,0.27f,2.19f,4.9f,1.04f,3.44f,1065.f},{13.9f,1.68f,2.12f,16.f,101.f,3.1f,3.39f,0.21f,2.14f,6.1f,0.91f,3.33f,985.f},
    {14.1f,2.02f,2.4f,18.8f,103.f,2.75f,2.92f,0.32f,2.38f,6.2f,1.07f,2.75f,1060.f},{13.94f,1.73f,2.27f,17.4f,108.f,2.88f,3.54f,0.32f,2.08f,8.9f,1.12f,3.1f,1260.f},
    {13.05f,1.73f,2.04f,12.4f,92.f,2.72f,3.27f,0.17f,2.91f,7.2f,1.12f,2.91f,1150.f},{13.83f,1.65f,2.6f,17.2f,94.f,2.45f,2.99f,0.22f,2.29f,5.6f,1.24f,3.37f,1265.f},
    {13.82f,1.75f,2.42f,14.f,111.f,3.88f,3.74f,0.32f,1.87f,7.05f,1.01f,3.26f,1190.f},{13.77f,1.9f,2.68f,17.1f,115.f,3.f,2.79f,0.39f,1.68f,6.3f,1.13f,2.93f,1375.f},
    {13.74f,1.67f,2.25f,16.4f,118.f,2.6f,2.9f,0.21f,1.62f,5.85f,0.92f,3.2f,1060.f},{13.56f,1.73f,2.46f,20.5f,116.f,2.96f,2.78f,0.2f,2.45f,6.25f,0.98f,3.03f,1120.f},
    {14.22f,1.7f,2.3f,16.3f,118.f,3.2f,3.f,0.26f,2.03f,6.38f,0.94f,3.31f,970.f},{13.29f,1.97f,2.68f,16.8f,102.f,3.f,3.23f,0.31f,1.66f,6.f,1.07f,2.84f,1270.f},
    {13.72f,1.43f,2.5f,16.7f,108.f,3.4f,3.67f,0.19f,2.04f,6.8f,0.89f,2.87f,1285.f},
    {12.37f,0.94f,1.36f,10.6f,88.f,1.98f,0.57f,0.28f,0.42f,1.95f,1.05f,1.82f,520.f},{12.33f,1.1f,2.28f,16.f,101.f,2.05f,1.09f,0.63f,0.41f,3.27f,1.25f,1.67f,680.f},
    {12.64f,1.36f,2.02f,16.8f,100.f,2.02f,1.41f,0.53f,0.62f,5.75f,0.98f,1.59f,450.f},{13.67f,1.25f,1.92f,18.f,94.f,2.1f,1.79f,0.32f,0.73f,3.8f,1.23f,2.46f,630.f},
    {12.37f,1.13f,2.16f,19.f,87.f,3.5f,3.1f,0.19f,1.87f,4.45f,1.22f,2.87f,420.f},{12.17f,1.45f,2.53f,19.f,104.f,1.89f,1.75f,0.45f,1.03f,2.95f,1.45f,2.23f,355.f},
    {12.37f,1.21f,2.56f,18.1f,98.f,2.42f,2.65f,0.37f,2.08f,4.6f,1.19f,2.3f,678.f},{13.11f,1.01f,1.7f,15.f,78.f,2.98f,3.18f,0.26f,2.28f,5.3f,1.12f,3.18f,502.f},
    {12.37f,1.17f,1.92f,19.6f,78.f,2.11f,2.f,0.27f,1.04f,4.68f,1.12f,3.48f,510.f},{13.34f,0.94f,2.36f,17.f,110.f,2.53f,1.3f,0.55f,0.42f,3.17f,1.02f,1.93f,750.f},
    {12.21f,1.19f,1.75f,16.8f,151.f,1.85f,1.28f,0.14f,2.5f,2.85f,1.28f,3.07f,718.f},{12.29f,1.61f,2.21f,20.4f,103.f,1.1f,1.02f,0.37f,1.46f,3.05f,0.906f,1.82f,870.f},
    {13.86f,1.51f,2.67f,25.f,86.f,2.95f,2.86f,0.21f,1.87f,3.38f,1.36f,3.16f,410.f},{13.49f,1.66f,2.24f,24.f,87.f,1.88f,1.84f,0.27f,1.03f,3.74f,0.98f,2.78f,472.f},
    {12.99f,1.67f,2.6f,30.f,139.f,3.3f,2.89f,0.21f,1.96f,3.35f,1.31f,3.5f,985.f},{11.96f,1.09f,2.3f,21.f,101.f,3.38f,2.14f,0.13f,1.65f,3.21f,0.99f,3.13f,886.f},
    {11.66f,1.88f,1.92f,16.f,97.f,1.61f,1.57f,0.34f,1.15f,3.8f,1.23f,2.14f,428.f},{13.03f,0.9f,1.71f,16.f,86.f,1.95f,2.03f,0.24f,1.46f,4.6f,1.19f,2.48f,392.f},
    {11.84f,2.89f,2.23f,18.f,112.f,1.72f,1.32f,0.43f,0.95f,2.65f,0.96f,2.52f,500.f},{12.33f,0.99f,1.95f,14.8f,136.f,1.9f,1.85f,0.35f,2.76f,3.4f,1.06f,2.31f,750.f},
    {12.7f,3.87f,2.4f,23.f,101.f,2.83f,2.55f,0.43f,1.95f,2.57f,1.19f,3.13f,463.f},{12.f,0.92f,2.f,19.f,86.f,2.42f,2.26f,0.3f,1.43f,2.5f,1.38f,3.12f,278.f},
    {12.72f,1.81f,2.2f,18.8f,86.f,2.2f,2.53f,0.26f,1.77f,3.9f,1.16f,3.14f,714.f},{12.08f,1.13f,2.51f,24.f,78.f,2.f,1.58f,0.4f,1.4f,2.2f,1.31f,2.72f,630.f},
    {13.05f,3.86f,2.32f,22.5f,85.f,1.65f,1.59f,0.61f,1.62f,4.8f,0.84f,2.01f,515.f},{11.84f,0.89f,2.58f,18.f,94.f,2.2f,2.21f,0.22f,2.35f,3.05f,0.79f,3.08f,520.f},
    {12.67f,0.98f,2.24f,18.f,99.f,2.2f,1.94f,0.3f,1.46f,2.62f,1.23f,3.16f,450.f},{12.16f,1.61f,2.31f,22.8f,90.f,1.78f,1.69f,0.43f,1.56f,2.45f,1.33f,2.26f,495.f},
    {11.65f,1.67f,2.62f,26.f,88.f,1.92f,1.61f,0.4f,1.34f,2.6f,1.36f,3.21f,562.f},{11.64f,2.06f,2.46f,21.6f,84.f,1.95f,1.69f,0.48f,1.35f,2.8f,1.f,2.75f,680.f},
    {12.08f,1.33f,2.3f,23.6f,70.f,2.2f,1.59f,0.42f,1.38f,1.74f,1.07f,3.21f,625.f},{12.08f,1.83f,2.32f,18.5f,81.f,1.6f,1.5f,0.52f,1.64f,2.4f,1.08f,2.27f,480.f},
    {12.f,1.51f,2.42f,22.f,86.f,1.45f,1.25f,0.5f,1.63f,3.6f,1.05f,2.65f,450.f},{12.69f,1.53f,2.26f,20.7f,80.f,1.38f,1.46f,0.58f,1.62f,3.05f,0.96f,2.06f,495.f},
    {12.29f,2.83f,2.22f,18.f,88.f,2.45f,2.25f,0.25f,1.99f,2.15f,1.15f,3.3f,290.f},{11.62f,1.99f,2.28f,18.f,98.f,3.02f,2.26f,0.17f,1.35f,3.25f,1.16f,2.96f,345.f},
    {12.47f,1.52f,2.2f,19.f,162.f,2.5f,2.27f,0.32f,3.28f,2.6f,1.16f,2.63f,937.f},{11.81f,2.12f,2.74f,21.5f,134.f,1.6f,0.99f,0.14f,1.56f,2.5f,0.95f,2.26f,625.f},
    {12.29f,1.41f,1.98f,16.f,85.f,2.55f,2.5f,0.29f,1.77f,2.9f,1.23f,2.74f,428.f},{12.37f,1.07f,2.1f,18.5f,88.f,3.52f,3.75f,0.24f,1.95f,4.5f,1.04f,2.77f,660.f},
    {12.29f,3.17f,2.21f,18.f,88.f,2.85f,2.99f,0.45f,2.81f,2.3f,1.42f,2.83f,406.f},{12.08f,2.08f,1.7f,17.5f,97.f,2.23f,2.17f,0.26f,1.4f,3.3f,1.27f,2.96f,710.f},
    {12.6f,1.34f,1.9f,18.5f,88.f,1.45f,1.36f,0.29f,1.35f,2.45f,1.04f,2.77f,562.f},{12.34f,2.45f,2.46f,21.f,98.f,2.56f,2.11f,0.34f,1.31f,2.8f,0.8f,3.38f,438.f},
    {11.82f,1.72f,1.88f,19.5f,86.f,2.5f,1.64f,0.37f,1.42f,2.06f,0.94f,2.44f,415.f},{12.51f,1.73f,1.98f,20.5f,85.f,2.2f,1.92f,0.32f,1.48f,2.94f,1.04f,3.57f,672.f},
    {12.42f,2.55f,2.27f,22.f,90.f,1.68f,1.84f,0.66f,1.42f,2.7f,0.86f,3.3f,315.f},{12.25f,1.73f,2.12f,19.f,80.f,1.65f,2.03f,0.37f,1.63f,3.4f,1.f,3.17f,510.f},
    {12.72f,1.75f,2.28f,22.5f,84.f,1.38f,1.76f,0.48f,1.63f,3.3f,0.88f,2.42f,488.f},{12.22f,1.29f,1.94f,19.f,92.f,2.36f,2.04f,0.39f,2.08f,2.7f,0.86f,3.02f,312.f},
    {11.61f,1.35f,2.7f,20.f,94.f,2.74f,2.92f,0.29f,2.49f,2.65f,0.96f,3.26f,680.f},{11.46f,3.74f,1.82f,19.5f,107.f,3.18f,2.58f,0.24f,3.58f,2.9f,0.75f,2.81f,562.f},
    {12.52f,2.43f,2.17f,21.f,88.f,2.55f,2.27f,0.26f,1.22f,2.f,0.9f,2.78f,325.f},{11.76f,2.68f,2.92f,20.f,103.f,1.75f,2.03f,0.6f,1.05f,3.8f,1.23f,2.5f,607.f},
    {11.41f,0.74f,2.5f,21.f,88.f,2.48f,2.01f,0.42f,1.44f,3.08f,1.1f,2.31f,434.f},{12.08f,1.39f,2.5f,22.5f,84.f,2.56f,2.29f,0.43f,1.04f,2.9f,0.93f,3.19f,385.f},
    {11.03f,1.51f,2.2f,21.5f,85.f,2.46f,2.17f,0.52f,2.01f,1.9f,1.71f,2.87f,407.f},{11.82f,1.47f,1.99f,20.8f,86.f,1.98f,1.6f,0.3f,1.53f,1.95f,0.95f,3.33f,495.f},
    {12.42f,1.61f,2.19f,22.5f,108.f,2.f,2.09f,0.34f,1.61f,2.06f,1.06f,2.96f,345.f},{12.77f,3.43f,1.98f,16.f,80.f,1.63f,1.25f,0.43f,0.83f,3.4f,0.7f,2.12f,372.f},
    {12.f,3.43f,2.f,19.f,87.f,2.f,1.64f,0.37f,1.87f,1.28f,0.93f,3.05f,564.f},{11.45f,2.4f,2.42f,20.f,96.f,2.9f,2.79f,0.32f,1.83f,3.25f,0.8f,3.39f,625.f},
    {11.56f,2.05f,3.23f,28.5f,119.f,3.18f,5.08f,0.47f,1.87f,6.f,0.93f,3.69f,465.f},{12.42f,4.43f,2.73f,26.5f,102.f,2.2f,2.13f,0.43f,1.71f,2.08f,0.92f,3.12f,365.f},
    {13.05f,5.8f,2.13f,21.5f,86.f,2.62f,2.65f,0.3f,2.01f,2.6f,0.73f,3.1f,380.f},{11.87f,4.31f,2.39f,21.f,82.f,2.86f,3.03f,0.21f,2.91f,2.8f,0.75f,3.64f,380.f},
    {12.07f,2.16f,2.17f,21.f,85.f,2.6f,2.65f,0.37f,1.35f,2.76f,0.86f,3.28f,378.f},{12.43f,1.53f,2.29f,21.5f,86.f,2.74f,3.15f,0.39f,1.77f,3.94f,0.69f,2.84f,352.f},
    {11.79f,2.13f,2.78f,28.5f,92.f,2.13f,2.24f,0.58f,1.76f,3.f,0.97f,2.44f,466.f},{12.37f,1.63f,2.3f,24.5f,88.f,2.22f,2.45f,0.4f,1.9f,2.12f,0.89f,2.78f,342.f},
    {12.04f,4.3f,2.38f,22.f,80.f,2.1f,1.75f,0.42f,1.35f,2.6f,0.79f,2.57f,580.f},
    {12.86f,1.35f,2.32f,18.f,122.f,1.51f,1.25f,0.21f,0.94f,4.1f,0.76f,1.29f,630.f},{12.88f,2.99f,2.4f,20.f,104.f,1.3f,1.22f,0.24f,0.83f,5.4f,0.74f,1.42f,530.f},
    {12.81f,2.31f,2.4f,24.f,98.f,1.15f,1.09f,0.27f,0.83f,5.7f,0.66f,1.36f,560.f},{12.7f,3.55f,2.36f,21.5f,106.f,1.7f,1.2f,0.17f,0.84f,5.f,0.78f,1.29f,600.f},
    {12.51f,1.24f,2.25f,17.5f,85.f,2.f,0.58f,0.6f,1.25f,5.45f,0.75f,1.51f,650.f},{12.6f,2.46f,2.2f,18.5f,94.f,1.62f,0.66f,0.63f,0.94f,7.1f,0.73f,1.58f,695.f},
    {12.25f,4.72f,2.54f,21.f,89.f,1.38f,0.47f,0.53f,0.8f,3.85f,0.75f,1.27f,720.f},{12.53f,5.51f,2.64f,25.f,96.f,1.79f,0.6f,0.63f,1.1f,5.f,0.82f,1.69f,515.f},
    {13.49f,3.59f,2.19f,19.5f,88.f,1.62f,0.48f,0.58f,0.88f,5.7f,0.81f,1.82f,580.f},{12.84f,2.96f,2.61f,24.f,101.f,2.32f,0.6f,0.53f,0.81f,4.92f,0.89f,2.15f,590.f},
    {12.93f,2.81f,2.7f,21.f,96.f,1.54f,0.5f,0.53f,0.75f,4.6f,0.77f,2.31f,600.f},{13.36f,2.56f,2.35f,20.f,89.f,1.4f,0.5f,0.37f,0.64f,5.6f,0.7f,2.47f,780.f},
    {13.52f,3.17f,2.72f,23.5f,97.f,1.55f,0.52f,0.5f,0.55f,4.35f,0.89f,2.06f,520.f},{13.62f,4.95f,2.35f,20.f,92.f,2.f,0.8f,0.47f,1.02f,4.4f,0.91f,2.05f,550.f},
    {12.25f,3.88f,2.2f,18.5f,112.f,1.38f,0.78f,0.29f,1.14f,8.21f,0.65f,2.f,855.f},{13.16f,3.57f,2.15f,21.f,102.f,1.5f,0.55f,0.43f,1.3f,4.f,0.6f,1.68f,830.f},
    {13.88f,5.04f,2.23f,20.f,80.f,0.98f,0.34f,0.4f,0.68f,4.9f,0.58f,1.33f,415.f},{12.87f,4.61f,2.48f,21.5f,86.f,1.7f,0.65f,0.47f,0.86f,7.65f,0.54f,1.86f,625.f},
    {13.32f,3.24f,2.38f,21.5f,92.f,1.93f,0.76f,0.45f,1.25f,8.42f,0.55f,1.62f,650.f},{13.08f,3.9f,2.36f,21.5f,113.f,1.41f,1.39f,0.34f,1.14f,9.4f,0.57f,1.33f,550.f},
    {13.5f,3.12f,2.62f,24.f,123.f,1.4f,1.57f,0.22f,1.25f,8.6f,0.59f,1.3f,500.f},{12.79f,2.67f,2.48f,22.f,112.f,1.48f,1.36f,0.24f,1.26f,10.8f,0.48f,1.47f,480.f},
    {13.11f,1.9f,2.75f,25.5f,116.f,2.2f,1.28f,0.26f,1.56f,7.1f,0.61f,1.33f,425.f},{13.23f,3.3f,2.28f,18.5f,98.f,1.8f,0.83f,0.61f,1.87f,10.52f,0.56f,1.51f,675.f},
    {12.58f,1.29f,2.1f,20.f,103.f,1.48f,0.58f,0.53f,1.4f,7.6f,0.58f,1.55f,640.f},{13.17f,5.19f,2.32f,22.f,93.f,1.74f,0.63f,0.61f,1.55f,7.9f,0.6f,1.48f,725.f},
    {13.84f,4.12f,2.38f,19.5f,89.f,1.8f,0.83f,0.48f,1.56f,9.01f,0.57f,1.64f,480.f},{12.45f,3.03f,2.64f,27.f,97.f,1.9f,0.58f,0.63f,1.14f,7.5f,0.67f,1.73f,880.f},
    {14.34f,1.68f,2.7f,25.f,98.f,2.8f,1.31f,0.53f,2.7f,13.f,0.57f,1.96f,660.f},{13.48f,1.67f,2.64f,22.5f,89.f,2.6f,1.1f,0.52f,2.29f,11.75f,0.57f,1.78f,620.f},
    {12.36f,3.83f,2.38f,21.f,88.f,2.3f,0.92f,0.5f,1.04f,7.65f,0.56f,1.58f,520.f},{13.69f,3.26f,2.54f,20.f,107.f,1.83f,0.56f,0.5f,0.8f,5.88f,0.96f,1.82f,680.f},
    {12.85f,3.27f,2.58f,22.f,106.f,1.65f,0.6f,0.6f,0.96f,5.58f,0.87f,2.11f,570.f},{12.96f,3.45f,2.35f,18.5f,106.f,1.39f,0.7f,0.4f,0.94f,5.28f,0.68f,1.75f,675.f},
    {13.78f,2.76f,2.3f,22.f,90.f,1.35f,0.68f,0.41f,1.03f,9.58f,0.7f,1.68f,615.f},{13.73f,4.36f,2.26f,22.5f,88.f,1.28f,0.47f,0.52f,1.15f,6.62f,0.78f,1.75f,520.f},
    {13.45f,3.7f,2.6f,23.f,111.f,1.7f,0.92f,0.43f,1.46f,10.68f,0.85f,1.56f,695.f},{12.82f,3.37f,2.3f,19.5f,88.f,1.48f,0.66f,0.4f,0.97f,10.26f,0.72f,1.75f,685.f},
    {13.58f,2.58f,2.69f,24.5f,105.f,1.55f,0.84f,0.39f,1.54f,8.66f,0.74f,1.8f,750.f},{13.4f,4.6f,2.86f,25.f,112.f,1.98f,0.96f,0.27f,1.11f,8.5f,0.67f,1.92f,630.f},
    {12.2f,3.03f,2.32f,19.f,96.f,1.25f,0.49f,0.4f,0.73f,5.5f,0.66f,1.83f,510.f},{12.77f,2.39f,2.28f,19.5f,86.f,1.39f,0.51f,0.48f,0.64f,9.9f,0.57f,1.63f,470.f},
    {14.16f,2.51f,2.48f,20.f,91.f,1.68f,0.7f,0.44f,1.24f,9.7f,0.62f,1.71f,660.f},{13.71f,5.65f,2.45f,20.5f,95.f,1.68f,0.61f,0.52f,1.06f,7.7f,0.64f,1.74f,740.f},
    {13.4f,3.91f,2.48f,23.f,102.f,1.8f,0.75f,0.43f,1.41f,7.3f,0.7f,1.56f,750.f},{13.27f,4.28f,2.26f,20.f,120.f,1.59f,0.69f,0.43f,1.35f,10.2f,0.59f,1.56f,835.f},
    {13.17f,2.59f,2.37f,20.f,120.f,1.65f,0.68f,0.53f,1.46f,9.3f,0.6f,1.62f,840.f},{14.13f,4.1f,2.74f,24.5f,96.f,2.05f,0.76f,0.56f,1.35f,9.2f,0.61f,1.6f,560.f}
};

static const int WINE_Y[178] = {
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
    2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2
};

std::pair<std::vector<std::vector<float>>, std::vector<int>> loadBuiltinWine() {
    std::vector<std::vector<float>> X;
    std::vector<int> labels;
    X.reserve(178);
    labels.reserve(178);
    for (int i = 0; i < 178; i++) {
        std::vector<float> row(13);
        for (int j = 0; j < 13; j++) row[j] = WINE_X[i][j];
        X.push_back(row);
        labels.push_back(WINE_Y[i]);
    }
    return {X, labels};
}
